!function(a,e,n,t){"use strict";a.module("app").directive("dateSwiper",["$rootScope","$timeout",function(s,r){var d="YYYY-MM-DD",i=function(a,n,t){var s=e([a,n,t]);return{num:s.date(),date:s.format(d),weekday:s.weekday()}},o=function(a){var t=e(a).startOf("month"),s=t.year(),r=t.month(),d=t.format("MMMM"),o=[],l=e(t).subtract(1,"month"),c=t.isoWeekday(),u=[],m=[],p=0,f=l.daysInMonth(),h=e(t).add(1,"month"),v=1,y=0,w=[],g=[];for(o=n.times(t.daysInMonth(),function(a){return i(s,r,a+1)});c>p;)u.unshift(f),p++,f--;for(m=n.times(u.length,function(a){return i(l.year(),l.month(),u[a])}),y=o.length+u.length;y%14!==0;)w.push(v),v++,y++;return g=n.times(w.length,function(a){return i(h.year(),h.month(),w[a])}),{currDays:o,currYear:s,currMonth:r+1,currMonthName:d,prevDays:m,nextDays:g}},l=function(a){var e,t,s,r;return n.times(3,function(d){var i=d>0?-100*d:0;e=Math.abs(a-i),(n.isUndefined(t)||t>e)&&(t=e,s=d,r=i)}),{key:s,value:r}},c=function(a){var n=[];return a=e(a).isValid()?e(a).valueOf():e().valueOf(),n.push(o(e(a).subtract(1,"month"))),n.push(o(e(a))),n.push(o(e(a).add(1,"month"))),n};return{restrict:"E",replace:!0,scope:{config:"=?",date:"=?"},template:'<div class="date-swiper" ng-class="{\'is-active\': config.show}"><div class="toggle"></div><div class="carousel"><div class="month month-{{$index+1}} month-{{m.currYear}}-{{m.currMonth}}" ng-repeat="m in months"><div class="month-name">{{m.currMonthName}} <span class="month-year">{{m.currYear}}</span></div><div class="days"><ul class="day-names"><li ng-repeat="l in dayLabels track by $index" ng-class="{\'is-weekend\': $first || $last}"><span class="day-name">{{l}}</span></li></ul><ul class="month-days"><li ng-repeat="d in m.prevDays" class="day-in-prev-month" data-date="{{d.date}}" ng-class="setClass(d)"><div class="date" title="{{d.date}}">{{d.num}}</div></li><li ng-repeat="d in m.currDays" class="day-in-curr-month" data-date="{{d.date}}" ng-class="setClass(d)"><div class="date" title="{{d.date}}">{{d.num}}</div></li><li ng-repeat="d in m.nextDays" class="day-in-next-month" data-date="{{d.date}}" ng-class="setClass(d)"><div class="date" title="{{d.date}}">{{d.num}}</div></li></ul></div></div></div></div>',link:function(i,o){var u=[],m=[],p=0,f,h=1,v=e().format(d),y=a.element(o[0]),w=a.element(o[0].querySelector(".carousel")),g=a.element(o[0].querySelector(".toggle")),k=[{key:0,value:0},{key:1,value:-100},{key:2,value:-200}],M=function(a){i.date=e(a).valueOf(),s.$emit(i.config.prefix+"date",i.date)},C=function(){u=a.element(o[0].querySelectorAll(".month-days li")),n.each(u,function(a,e){m[e]=new t(a,{}),m[e].on("tap",function(a){M(a.target.dataset.date),i.$apply()})})},D=function(){u=a.element(o[0].querySelectorAll(".month-days li")),n.each(u,function(a,e){m[e].destroy()}),i.$apply()},S=function(){i.bound=[],i.dayLabels=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],i.date=e(i.date).isValid()?e(i.date).valueOf():e().valueOf(),i.months=c(i.date),i.snap=k[1],w.addClass("animate").css({transform:"translate3d("+i.snap.value+"vw, 0, 0)"}),r(function(){C()},10)};i.setClass=function(a){var e=[];return a.date===i.date&&e.push("is-selected"),a.date===v&&e.push("is-today"),(0===a.weekday||6===a.weekday)&&e.push("is-weekend"),e.join(" ")};var Y=new t(g[0],{}),b=new t(y[0],{threshold:0});Y.on("tap",function(){i.config.show=!i.config.show,i.$apply()}),b.on("panstart",function(){window.console.log("start",i.snap.key),w.removeClass("animate"),i.$apply()}),b.on("panleft panright",function(a){p=i.snap.value+parseInt(a.deltaX)/o[0].clientWidth*100,w.css({transform:"translate3d("+p+"vw, 0, 0)"}),f=a.type,i.$apply()}),b.on("panend",function(){h=i.snap.key,i.snap=l(p);var a=i.months[i.snap.key];w.addClass("animate").css({transform:"translate3d("+i.snap.value+"vw, 0, 0)"}),r(function(){h!==i.snap.key&&1!==i.snap.key&&(D(),i.months=c(e([a.currYear,a.currMonth-1]).valueOf()),r(function(){i.snap=k[1],w.removeClass("animate").css({transform:"translate3d("+i.snap.value+"vw, 0, 0)"}),C()},10))},300),i.$apply()}),s.$on(i.config.prefix+"set-date",function(a,e){M(e)}),i.$watch("config",function(a){return a}),i.$watch("date",function(a){window.console.log("watch:",a),i.date=e(a).format(d)}),S()}}}])}(window.angular,window.moment,window._,window.Hammer);