!function(a,t,n,e){"use strict";a.module("app").directive("tap",[function(){return function(a,t,n){var s=new e(t[0],{});s.on("tap",function(){a.$apply(function(){a.$eval(n.tap)})})}}]).directive("dateSwiper",["$rootScope","$timeout",function(s,r){var d="YYYY-MM-DD",i=t().format(d),o=function(a){var t,e,s,r;return n.times(3,function(d){var i=d>0?-100*d:0;t=Math.abs(a-i),(n.isUndefined(e)||e>t)&&(e=t,s=d,r=i)}),{key:s,value:r}},c=function(a,n,e){var s=t([a,n,e]);return{num:s.date(),date:s.format(d),weekday:s.weekday()}},l=function(a){var e=t(a).startOf("month"),s=e.year(),r=e.month(),d=e.format("MMMM"),i=[],o=t(e).subtract(1,"month"),l=e.isoWeekday(),u=[],m=[],f=0,p=o.daysInMonth(),h=t(e).add(1,"month"),v=1,y=0,g=[],w=[];for(i=n.times(e.daysInMonth(),function(a){return c(s,r,a+1)});l>f;)u.unshift(p),f++,p--;for(m=n.times(u.length,function(a){return c(o.year(),o.month(),u[a])}),y=i.length+u.length;y%14!==0;)g.push(v),v++,y++;return w=n.times(g.length,function(a){return c(h.year(),h.month(),g[a])}),{currDays:i,currYear:s,currMonth:r+1,currMonthName:d,prevDays:m,nextDays:w}},u=function(a){var n=[];return a=t(a).isValid()?t(a).valueOf():t().valueOf(),n.push(l(t(a).subtract(1,"month"))),n.push(l(t(a))),n.push(l(t(a).add(1,"month"))),n},m=function(a){return"today"===a?a=i:"tomorrow"===a?a=t(i).add(1,"day"):"yesterday"===a&&(a=t(i).subtract(1,"day")),a};return{restrict:"E",replace:!0,scope:{config:"=?",date:"=?"},template:'<div class="date-swiper" ng-class="{\'is-active\': config.show}"><div class="carousel"><div class="month month-{{$index+1}} month-{{m.currYear}}-{{m.currMonth}}" ng-repeat="m in months track by $index"><div class="month-name">{{m.currMonthName}} <span class="month-year">{{m.currYear}}</span></div><div class="days"><ul class="day-names"><li ng-repeat="n in dayNames track by $index" ng-class="{\'is-weekend\': $first || $last}"><span class="day-name">{{n}}</span></li></ul><ul class="month-days"><li ng-repeat="d in m.prevDays track by $index" tap="setDate(d.date)" xdata-date="{{d.date}}" class="day-in-prev-month" ng-class="setClass(d)"><div class="date">{{d.num}}</div></li><li ng-repeat="d in m.currDays track by $index" tap="setDate(d.date)" xdata-date="{{d.date}}" class="day-in-curr-month" ng-class="setClass(d)"><div class="date">{{d.num}}</div></li><li ng-repeat="d in m.nextDays track by $index" tap="setDate(d.date)" xdata-date="{{d.date}}" class="day-in-next-month" ng-class="setClass(d)"><div class="date">{{d.num}}</div></li></ul></div></div></div><div class="toggle" tap="toggle()"></div></div>',link:function(n,c){var l=n.config.prefix||"date-swiper",f=a.element(c[0]),p=a.element(c[0].querySelector(".carousel")),h=new e(f[0]),v,y=0,g=0,w=[{key:0,value:0},{key:1,value:-100},{key:2,value:-200}],k=function(a){var e=n.months[a.key];p.removeClass("dragging").addClass("animate").css({transform:"translate3d("+a.value+"vw, 0, 0)"}),1!==a.key&&r(function(){n.months=u(t([e.currYear,e.currMonth-1]).valueOf()),n.snap=w[1],p.removeClass("animate").css({transform:"translate3d("+n.snap.value+"vw, 0, 0)"})},300)},M=function(a){return a=m(a),a=t(a).isValid()?t(a).format(d):null};n.setDate=function(a){n.date=M(a),n.months=u(n.date),k(n.snap)},n.setClass=function(a){var t=[];return a.date===n.date&&t.push("is-selected"),a.date===i&&t.push("is-today"),(0===a.weekday||6===a.weekday)&&t.push("is-weekend"),t.join(" ")},n.toggle=function(){n.config.show=!n.config.show},h.get("pan").set({direction:e.DIRECTION_ALL,threshold:0}),h.on("panstart",function(){p.addClass("dragging").removeClass("animate"),f.addClass("dragging")}).on("panleft panright panup pandown",function(a){v=Math.abs(parseInt(a.deltaX))>Math.abs(parseInt(a.deltaY))?"x":"y",y=n.snap.value+parseInt(a.deltaX)/c[0].clientWidth*100*n.mod,g=parseInt(a.deltaY)/c[0].clientHeight*100*n.mod,g=0>g?0:g,"x"===v?p.css({transform:"translate3d("+y+"vw, 0, 0)"}):f.css({transform:"translate3d(0, "+g+"vh, 0)"})}).on("panend",function(){f.removeClass("dragging").css({transform:""}),"x"===v&&(n.snap=o(y),k(n.snap)),"y"===v&&g>35&&n.toggle(),n.$apply()}),s.$on(l+":set",function(a,t){n.setDate(t)}),s.$on(l+":show",function(a,t){n.config.show=!0,n.setDate(t)}),s.$on(l+":hide",function(){n.config.show=!1}),n.$watch("date",function(a){return t(a).isValid()?t(a).format(d):a});var x=function(a){n.dayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],n.mod=parseFloat(n.config.modifier)<.75?.75:parseFloat(n.config.modifier),n.snap=w[1],n.setDate(a)};x(n.date)}}}])}(window.angular,window.moment,window._,window.Hammer);