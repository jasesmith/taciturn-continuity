!function(a,e,n){"use strict";a.module("app").directive("calendar",["$rootScope","UiService",function(a,n){var t=function(a){var n=e(a).startOf("month"),t=n.year(),i=n.month(),s=n.format("MMMM"),o=_.times(n.daysInMonth(),function(a){a+=1;var n=e([t,i,a]);return{num:a,date:n.format("YYYY-MM-DD"),weekday:n.weekday()}}),d=n.isoWeekday(),r=e(a).subtract(1,"month").daysInMonth(),c=[];if(d>0)for(var l=0,v=r;d>l;)c.unshift(v),l++,v--;for(var m=1,u=[],h=o.length+u.length+c.length;h%14!==0;)u.push(m),m++,h++;return{days:o,name:s,year:t,month:i+1,prevMonthDays:c,nextMonthDays:u}};return{restrict:"E",replace:!0,scope:{config:"="},controller:function(n){n.months=_.times(n.config.seeds,function(a){return t(e(n.config.start).add(a,"months"))}),a.$on("calendar:show",function(a,t){var i=e(t).month(),s=_.findIndex(n.months,function(a){return a.month===i+1});n.showCalendar=!0,n.activeDate=e(t).format("YYYY-MM-DD"),n.$emit(n.config.prefix+"set-key",s)})},template:'<div class="calendar-wrap" ng-class="{\'active\': showCalendar}"><div class="close-view calendar-toggle fg-active" hm-tap="hideCalendar($event)"></div><div class="carousel-wrap" swipe-and-snap snaps="config.seeds"><div class="slide month" ng-repeat="month in months track by $index"><div class="month-name">{{month.name}} <span class="shadow">{{month.year}}</span></div><div class="days"><ul class="day-names"><li ng-repeat="dayLabel in dayLabels track by $index" ng-class="{\'weekend\': $first || $last}">{{dayLabel}}</li></ul><ul><li ng-repeat="day in month.prevMonthDays"><div class="date disabled ghost">{{day}}</div></li><li ng-repeat="day in month.days" title="{{day.date}}" hm-tap="setActiveDate($event, day.date)"><div class="date" ng-class="setClass(day)" title="{{day.date}}">{{day.num}}</div></li><li ng-repeat="day in month.nextMonthDays"><div class="date disabled ghost">{{day}}</div></li></ul></div></div></div></div>',link:function(a,t,i){var s=e().format("YYYY-MM-DD");a.dayLabels=_dayLabels,a.hideCalendar=function(e){n.eventHijack(e),a.showCalendar=!1},a.setActiveDate=function(t,i){n.eventHijack(t),a.activeDate=e(i).format("YYYY-MM-DD"),a.$emit(a.config.prefix+"date",a.activeDate)},a.setClass=function(e){var n=[];return e.date===a.activeDate&&n.push("active"),e.date===s&&n.push("today"),(0===e.weekday||6===e.weekday)&&n.push("weekend"),n.join(" ")}}}}]).directive("swipeAndSnap",["$rootScope",function(a){var e=function(a,e){var n,t,i,s;return _.each(a,function(a,o){n=Math.abs(e-a),(void 0===t||t>n)&&(t=n,i=a,s=o)}),{key:s,value:i}};return{scope:{snaps:"="},controller:function(e){a.$on("minder:set-key",function(a,n){e.element.css({transform:"translate3d("+e.snapGrid[n]+"vw, 0, 0)"}),e.activeKey=n})},link:function(a,t,i){a.element=t,a.activeLocation=0,a.activeKey=0;var s=0;a.snapGrid=_.times(a.snaps,function(a){return 100*-a});var o=new n(t[0]);o.on("panstart",function(a){t.removeClass("animate")}),o.on("pan",function(e){s=a.activeLocation+parseInt(e.deltaX)/document.body.clientWidth*100,t.css({transform:"translate3d("+s+"vw, 0, 0)"})}),o.on("panend",function(n){t.addClass("animate");var i=e(a.snapGrid,s);a.activeLocation=i.value,t.css({transform:"translate3d("+a.activeLocation+"vw, 0, 0)"}),a.activeKey=i.key,a.$apply(),a.$emit("calendar:changed",i)})}}}])}(window.angular,window.moment,window.Hammer);