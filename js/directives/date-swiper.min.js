!function(a,t,e,n){"use strict";a.module("app").directive("tap",[function(){return function(a,t,e){var s=new n(t[0],{});s.on("tap",function(){a.$apply(function(){a.$eval(e.tap)})})}}]).directive("dateSwiper",["$rootScope","$timeout",function(s,o){var r={};return r.dFormat="YYYY-MM-DD",r.today=t().format(r.dFormat),r._buildDayObject=function(a,e,n){var s=t([a,e,n]);return{num:s.date(),date:s.format(r.dFormat),weekday:s.weekday(),month:e}},r._calendarData=function(a){var n=t(a).startOf("month"),s=[];s=e.times(n.daysInMonth(),function(a){return r._buildDayObject(n.year(),n.month(),a+1)});for(var o=t(n).subtract(1,"month"),i=[],d=[],c=0,l=o.daysInMonth();c<n.isoWeekday();)i.unshift(l),c++,l--;d=e.times(i.length,function(a){return r._buildDayObject(o.year(),o.month(),i[a])});var u=t(n).add(1,"month"),m=1,h=0,f=[],y=[];for(h=s.length+i.length;h%14!==0;)f.push(m),m++,h++;return y=e.times(f.length,function(a){return r._buildDayObject(u.year(),u.month(),f[a])}),{days:d.concat(s).concat(y),year:n.year(),month:n.month(),monthName:n.format("MMMM")}},r._generateMonths=function(a){var e=[];return a=t(a).isValid()?t(a).valueOf():t().valueOf(),e.push(r._calendarData(t(a).subtract(1,"month"))),e.push(r._calendarData(t(a))),e.push(r._calendarData(t(a).add(1,"month"))),e},r._tryFuzzyDates=function(a){return"today"===a?a=r.today:"tomorrow"===a?a=t(r.today).add(1,"day"):"yesterday"===a&&(a=t(r.today).subtract(1,"day")),a},r._setActiveDate=function(a){return a=r._tryFuzzyDates(a),t(a).isValid()?t(a).format(r.dFormat):null},{restrict:"E",replace:!0,scope:{config:"=?",date:"=?"},template:'<div class="date-swiper" ng-class="{\'is-active\': config.show}"><div class="carousel"><div class="month month-{{$index+1}} month-{{m.year}}-{{m.month+1}}" ng-repeat="m in months track by $index"><div class="month-name">{{m.monthName}} <span class="month-year">{{m.year}}</span></div><ul class="day-names"><li ng-repeat="n in dayNames track by $index" ng-class="{\'is-weekend\': $first || $last}"><div class="day-name">{{n}}</div></li></ul><ul class="days"><li ng-repeat="d in m.days track by $index" tap="setDate(d.date)" ng-class="setClass(d, m)"><div class="date">{{d.num}}</div></li></ul></div></div><div class="toggle" tap="toggle()"></div></div>',link:function(i,d){var c=i.config.prefix||"date-swiper",l=a.element(d[0]),u=a.element(d[0].querySelector(".carousel")),m=new n(l[0]),h,f=0,y=0,p=[{key:0,value:0},{key:1,value:-100},{key:2,value:-200}],v=function(a){var t,n,s,o;return e.times(3,function(r){var i=r>0?-100*r:0;t=Math.abs(a-i),(e.isUndefined(n)||n>t)&&(n=t,s=r,o=i)}),{key:s,value:o}},g=function(a){var e=i.months[a.key];u.removeClass("dragging").addClass("animate").css({transform:"translate3d("+a.value+"%, 0, 0)"}),1!==a.key&&o(function(){i.months=r._generateMonths(t([e.year,e.month]).valueOf()),i.snap=p[1],u.removeClass("animate").css({transform:"translate3d("+i.snap.value+"%, 0, 0)"})},300)};i.setDate=function(a){i.date=r._setActiveDate(a),i.months=r._generateMonths(i.date),g(i.snap)},i.setClass=function(a,t){var e=[];return a.date===i.date&&e.push("is-selected"),a.date===r.today&&e.push("is-today"),(0===a.weekday||6===a.weekday)&&e.push("is-weekend"),a.month===t.month&&e.push("day-in-curr-month"),e.join(" ")},i.toggle=function(){i.config.show=!i.config.show},m.get("pan").set({direction:n.DIRECTION_ALL,threshold:0}),m.on("panstart",function(){u.addClass("dragging").removeClass("animate"),l.addClass("dragging")}).on("panleft panright panup pandown",function(a){h=Math.abs(parseInt(a.deltaX))>Math.abs(parseInt(a.deltaY))?"x":"y",f=i.snap.value+parseInt(a.deltaX)/d[0].clientWidth*100*i.mod,y=parseInt(a.deltaY)/d[0].clientHeight*100*i.mod,y=0>y?0:y,"x"===h?u.css({transform:"translate3d("+f+"%, 0, 0)"}):l.css({transform:"translate3d(0, "+y+"%, 0)"})}).on("panend",function(){l.removeClass("dragging").css({transform:""}),"x"===h&&(i.snap=v(f),g(i.snap)),"y"===h&&y>35&&i.toggle(),i.$apply()}),s.$on(c+":set",function(a,t){i.setDate(t)}),s.$on(c+":show",function(a,t){i.config.show=!0,i.setDate(t)}),s.$on(c+":hide",function(){i.config.show=!1});var w=function(a){i.dayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],i.mod=parseFloat(i.config.modifier)<.75?.75:parseFloat(i.config.modifier),i.snap=p[1],i.setDate(a)};w(i.date)}}}])}(window.angular,window.moment,window._,window.Hammer);