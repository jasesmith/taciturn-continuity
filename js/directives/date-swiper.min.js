!function(a,n,e,t){"use strict";a.module("app").directive("dateSwiper",["$rootScope","$timeout",function(s,o){var d="YYYY-MM-DD",r=function(a,e,t){var s=n([a,e,t]);return{num:s.date(),date:s.format(d),weekday:s.weekday()}},i=function(a){var t=n(a).startOf("month"),s=t.year(),o=t.month(),d=t.format("MMMM"),i=[],l=n(t).subtract(1,"month"),c=t.isoWeekday(),u=[],m=[],p=0,h=l.daysInMonth(),f=n(t).add(1,"month"),y=1,v=0,w=[],g=[];for(i=e.times(t.daysInMonth(),function(a){return r(s,o,a+1)});c>p;)u.unshift(h),p++,h--;for(m=e.times(u.length,function(a){return r(l.year(),l.month(),u[a])}),v=i.length+u.length;v%14!==0;)w.push(y),y++,v++;return g=e.times(w.length,function(a){return r(f.year(),f.month(),w[a])}),{currDays:i,currYear:s,currMonth:o+1,currMonthName:d,prevDays:m,nextDays:g}},l=function(a){var n,t,s,o;return e.times(3,function(d){var r=d>0?-100*d:0;n=Math.abs(a-r),(e.isUndefined(t)||t>n)&&(t=n,s=d,o=r)}),{key:s,value:o}},c=function(a){var e=[];return a=n(a).isValid()?n(a).valueOf():n().valueOf(),e.push(i(n(a).subtract(1,"month"))),e.push(i(n(a))),e.push(i(n(a).add(1,"month"))),e};return{restrict:"E",replace:!0,scope:{config:"=?",date:"=?"},template:'<div class="date-swiper" ng-class="{\'is-active\': config.show}"><div class="carousel"><div class="month month-{{$index+1}} month-{{m.currYear}}-{{m.currMonth}}" ng-repeat="m in months"><div class="month-name">{{m.currMonthName}} <span class="month-year">{{m.currYear}}</span></div><div class="days"><ul class="day-names"><li ng-repeat="l in dayLabels track by $index" ng-class="{\'is-weekend\': $first || $last}"><span class="day-name">{{l}}</span></li></ul><ul class="month-days"><li ng-repeat="d in m.prevDays" class="day-in-prev-month" data-date="{{d.date}}" ng-class="setClass(d)"><div class="date" title="{{d.date}}">{{d.num}}</div></li><li ng-repeat="d in m.currDays" class="day-in-curr-month" data-date="{{d.date}}" ng-class="setClass(d)"><div class="date" title="{{d.date}}">{{d.num}}</div></li><li ng-repeat="d in m.nextDays" class="day-in-next-month" data-date="{{d.date}}" ng-class="setClass(d)"><div class="date" title="{{d.date}}">{{d.num}}</div></li></ul></div></div></div><div class="toggle"></div></div>',link:function(r,i){var u=[],m=[],p=0,h,f=1,y=n().format(d),v=a.element(i[0]),w=a.element(i[0].querySelector(".carousel")),g=a.element(i[0].querySelector(".toggle")),k=r.config.prefix||"date-swiper",M=[{key:0,value:0},{key:1,value:-100},{key:2,value:-200}],S=function(a){return"today"===a&&(a=y),"tomorrow"===a&&(a=n(y).add(1,"day")),"yesterday"===a&&(a=n(y).subtract(1,"day")),a},D=function(a){r.date=n(a).isValid()?n(a).format(d):S(a),s.$emit(k+":date",r.date)},b=function(){u=a.element(i[0].querySelectorAll(".month-days li")),e.each(u,function(a,n){m[n]=new t(a,{}),m[n].on("tap",function(a){D(a.target.dataset.date),r.$apply()})})},C=function(){u=a.element(i[0].querySelectorAll(".month-days li")),e.each(u,function(a,n){m[n].destroy()}),r.$apply()},Y=function(){r.bound=[],r.dayLabels=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],r.months=c(r.date),r.snap=M[1],w.addClass("animate").css({transform:"translate3d("+r.snap.value+"vw, 0, 0)"}),o(function(){b()},10)};r.setClass=function(a){var n=[];return a.date===r.date&&n.push("is-selected"),a.date===y&&n.push("is-today"),(0===a.weekday||6===a.weekday)&&n.push("is-weekend"),n.join(" ")};var x=new t(g[0],{}),O=new t(v[0],{threshold:0});x.on("tap",function(){r.config.show=!r.config.show,r.$apply()}),O.on("panstart",function(){window.console.log("start",r.snap.key),w.removeClass("animate"),r.$apply()}),O.on("panleft panright",function(a){p=r.snap.value+parseInt(a.deltaX)/i[0].clientWidth*100,w.css({transform:"translate3d("+p+"vw, 0, 0)"}),h=a.type,r.$apply()}),O.on("panend",function(){f=r.snap.key,r.snap=l(p);var a=r.months[r.snap.key];w.addClass("animate").css({transform:"translate3d("+r.snap.value+"vw, 0, 0)"}),f!==r.snap.key&&1!==r.snap.key&&(o(function(){C(),r.months=c(n([a.currYear,a.currMonth-1]).valueOf())},35),o(function(){r.snap=M[1],w.removeClass("animate").css({transform:"translate3d("+r.snap.value+"vw, 0, 0)"}),b()},65)),r.$apply()}),s.$on(k+":set",function(a,n){window.console.log("SET DATE",n),D(n)}),s.$on(k+":show",function(a,n){window.console.log("SHOW",n),D(n),r.config.show=!0}),s.$on(k+":hide",function(){r.config.show=!1}),r.$watch("date",function(a){a&&(window.console.log("watch:",a),r.date=n(a).isValid()?n(a).format(d):a)}),Y()}}}])}(window.angular,window.moment,window._,window.Hammer);